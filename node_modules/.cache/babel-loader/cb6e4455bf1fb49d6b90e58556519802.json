{"ast":null,"code":"var _jsxFileName = \"/home/rmehta/astrosat/Astrosat-Webapp/src/components/mainMap.js\",\n    _s = $RefreshSig$();\n\nimport React, { Component, useState, useEffect, useRef } from 'react';\nimport 'semantic-ui-css/semantic.min.css';\nimport pdf from \"../resources/info.pdf\";\nimport { geoPath } from \"d3-geo\";\nimport * as d3 from \"d3\";\nimport { Dropdown } from 'semantic-ui-react';\nimport { aitoffProj, hammerProj, mollweideProj, graticule, outline } from \"./utils\";\nimport \"./mainMap.css\";\nimport Navbar from \"./navbar\";\nimport { Form, Input, Button, Checkbox, Select, Row, Col } from \"antd\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst {\n  Option\n} = Select;\n\nconst versor = require(\"versor\");\n\nfunction Map(props) {\n  _s();\n\n  const [mapWidth, setMapWidth] = useState(window.innerWidth);\n  const [highlight, toggleHighlight] = useState(false);\n  const [highlightId, setHighlightId] = useState();\n  const [query, setQuery] = useState(\"\");\n  const [projVal, setProjVal] = useState(\"A\");\n  const [projection, setProjection] = useState(() => aitoffProj);\n  const [[x0, y0], [x1, y1]] = d3.geoPath(projection.fitWidth(mapWidth, outline)).bounds(outline);\n  const mapHeight = Math.ceil(y1 - y0),\n        l = Math.min(Math.ceil(x1 - x0), mapHeight);\n  projection.scale(projection.scale() * (l - 1) / l).precision(0.2);\n  const [path, setPath] = useState(() => geoPath(projection));\n  const [sources, setSources] = useState([]); // const [graticule, setGraticule] = useState(graticule);\n\n  var v0, q0, r0;\n  useEffect(() => {\n    fetch(\"https://backend.cosmoscope.in/cosmicsource/\").then(response => {\n      if (response.status !== 200) {\n        console.log(`There was a problem: ${response.status}`);\n        return;\n      }\n\n      response.json().then(cosmicData => {\n        setSources(cosmicData);\n      });\n    });\n    let map = d3.select(\"#outline\");\n    map.call(d3.drag().on(\"start\", dragstarted).on(\"drag\", dragged)); // map.call(zoom(projection))\n  }, []);\n\n  const dragstarted = event => {\n    v0 = versor.cartesian(projection.invert(d3.pointer(event)));\n    r0 = projection.rotate();\n    q0 = versor(r0);\n  };\n\n  const dragged = event => {\n    var v1 = versor.cartesian(projection.rotate(r0).invert(d3.pointer(event))),\n        q1 = versor.multiply(q0, versor.delta(v0, v1)),\n        r1 = versor.rotation(q1);\n    projection.rotate(r1);\n    setPath(() => geoPath(projection));\n  };\n\n  const handleSourceClick = id => {\n    toggleHighlight(highlight => !highlight);\n    setHighlightId(id);\n  };\n\n  function zoom(projection, {\n    // Capture the projection’s original scale, before any zooming.\n    scale = projection._scale === undefined ? projection._scale = projection.scale() : projection._scale,\n    scaleExtent = [0.8, 8]\n  } = {}) {\n    let vv0, qq0, rr0, aa0, tl;\n\n    const zoomstarted = event => {\n      vv0 = versor.cartesian(projection.invert(d3.pointer(event)));\n      qq0 = versor(rr0 = projection.rotate());\n    };\n\n    const zoomed = event => {\n      projection.scale(event.transform.k);\n      const pt = d3.pointer(event);\n      const vv1 = versor.cartesian(projection.rotate(rr0).invert(pt));\n      const deltaa = versor.delta(vv0, vv1);\n      let qq1 = versor.multiply(qq0, deltaa);\n      projection.rotate(versor.rotation(qq1));\n      setPath(() => geoPath(projection));\n    };\n\n    const zoom = d3.zoom().scaleExtent(scaleExtent.map(x => x * scale)).on(\"start\", zoomstarted).on(\"zoom\", zoomed);\n    return Object.assign(selection => selection.property(\"__zoom\", d3.zoomIdentity.scale(projection.scale())).call(zoom), {\n      on(type, ...options) {\n        return options.length ? (zoom.on(type, ...options), this) : zoom.on(type);\n      }\n\n    });\n  } // const handlePdf = e => {\n  //   const urlPDF = require()\n  //   window.open({pdf}, \"_blank\")\n  // }\n\n\n  function InfoPanel() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      class: \"bg\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        class: \"bgg\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Name: \", sources[highlightId].name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Ra, Dec: \", sources[highlightId].equatorial_ra, \", \", sources[highlightId].equatorial_dec]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Gal. Long/Lat: \", sources[highlightId].galactic_longitude, \", \", sources[highlightId].galactic_latitude]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"X-Ray Flux: \", sources[highlightId].x_ray_flux]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"AstroSat? : \", highlightId === 167 ? \"yes\" : \"no\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 9\n      }, this), highlightId === 167 && /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Observation date: 2018-09-17\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Observation time: 08:09:52\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Cycle: A04_230 T01\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Observation ID: 04_230T01_9000002374\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Observation ID: 04_230T01_9000002374\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Telescope: laxpc1\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n          href: pdf,\n          target: \"_blank\",\n          children: \"Download Pdf\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 7\n    }, this);\n  }\n\n  function findWithAttr(array, attr, value) {\n    for (var i = 0; i < array.length; i += 1) {\n      if (array[i][attr] === value) {\n        return i;\n      }\n    }\n\n    return -1;\n  }\n\n  const onSubmit = e => {\n    e.preventDefault();\n    var res = findWithAttr(sources, \"name\", query);\n\n    if (res === -1) {\n      res = findWithAttr(sources, \"name2\", query);\n    }\n\n    if (res === -1) {\n      res = findWithAttr(sources, \"name3\", query);\n    }\n\n    if (res !== -1) {\n      setHighlightId(res);\n      toggleHighlight(true);\n    }\n  };\n\n  useEffect(() => {\n    setPath(() => geoPath(projection));\n  }, [projection]);\n\n  const handleProjChange = (e, value) => {\n    if (value.value === \"A\") {\n      setProjection(() => aitoffProj);\n    } else if (value.value === \"H\") {\n      setProjection(() => hammerProj);\n    }\n\n    if (value.value === \"M\") {\n      setProjection(() => mollweideProj);\n    }\n  };\n\n  const onFinish = values => {\n    var res = findWithAttr(sources, \"name\", values.search);\n\n    if (res === -1) {\n      res = findWithAttr(sources, \"name2\", values.search);\n    }\n\n    if (res === -1) {\n      res = findWithAttr(sources, \"name3\", values.search);\n    }\n\n    if (res !== -1) {\n      setHighlightId(res);\n      toggleHighlight(true);\n    }\n  };\n\n  const onFinishFailed = errorInfo => {\n    console.log(\"Failed:\", errorInfo);\n  };\n\n  function Footer() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"custom-footer\",\n      style: {\n        color: 'black',\n        background: '#c0b9b924'\n      },\n      children: /*#__PURE__*/_jsxDEV(Row, {\n        children: [/*#__PURE__*/_jsxDEV(Col, {\n          span: 20,\n          children: /*#__PURE__*/_jsxDEV(Form, {\n            name: \"Query\",\n            initialValues: {\n              remember: true\n            },\n            onFinish: onFinish,\n            onFinishFailed: onFinishFailed,\n            layout: \"inline\",\n            children: [/*#__PURE__*/_jsxDEV(Form.Item, {\n              label: \"Search\",\n              placeholder: \"Name (Primary/Alternate)\",\n              name: \"search\",\n              children: /*#__PURE__*/_jsxDEV(Input, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 253,\n                columnNumber: 13\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 248,\n              columnNumber: 11\n            }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n              children: /*#__PURE__*/_jsxDEV(Button, {\n                type: \"primary\",\n                htmlType: \"submit\",\n                children: \"Submit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 257,\n                columnNumber: 11\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 256,\n              columnNumber: 11\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 239,\n            columnNumber: 9\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(Col, {\n          children: /*#__PURE__*/_jsxDEV(Form, {\n            name: \"Projection\",\n            layout: \"inline\",\n            children: /*#__PURE__*/_jsxDEV(Form.Item, {\n              label: \"Projection (ICRS)\",\n              name: \"type\",\n              rules: [{\n                required: true,\n                message: \"Please select projection\"\n              }],\n              style: {\n                display: \"flex\",\n                justifyContent: \"flex-end\",\n                justifyItems: \"flex-end\"\n              },\n              children: /*#__PURE__*/_jsxDEV(Select, {\n                placeholder: \"Projectiom\",\n                onChange: handleProjChange,\n                children: [/*#__PURE__*/_jsxDEV(Option, {\n                  value: \"A\",\n                  children: \"Aitoff\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 282,\n                  columnNumber: 13\n                }, this), /*#__PURE__*/_jsxDEV(Option, {\n                  value: \"H\",\n                  children: \"Hammer\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 283,\n                  columnNumber: 13\n                }, this), /*#__PURE__*/_jsxDEV(Option, {\n                  value: \"M\",\n                  children: \"Mollweide\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 284,\n                  columnNumber: 13\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 281,\n                columnNumber: 11\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 270,\n              columnNumber: 9\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 266,\n            columnNumber: 9\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 7\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      class: \"overlay\",\n      children: /*#__PURE__*/_jsxDEV(Navbar, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 302,\n        columnNumber: 28\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 302,\n      columnNumber: 7\n    }, this), highlight && /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(InfoPanel, {\n        id: 1\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 304,\n        columnNumber: 28\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 304,\n      columnNumber: 23\n    }, this), /*#__PURE__*/_jsxDEV(\"svg\", {\n      width: mapWidth,\n      height: mapHeight,\n      viewBox: `0 0 ${mapWidth} ${mapHeight}`,\n      id: \"map\",\n      children: [/*#__PURE__*/_jsxDEV(\"defs\", {\n        children: [/*#__PURE__*/_jsxDEV(\"path\", {\n          id: \"outline\",\n          d: path(outline)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 314,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"linearGradient\", {\n          id: \"grad2\",\n          x1: \"0%\",\n          y1: \"0%\",\n          x2: \"0%\",\n          y2: \"100%\",\n          children: [/*#__PURE__*/_jsxDEV(\"stop\", {\n            offset: \"0%\",\n            style: {\n              stopColor: `rgb(0,0,255)`,\n              stopOpacity: 1\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 319,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"stop\", {\n            offset: \"100%\",\n            style: {\n              stopColor: `rgb(0,0,0)`,\n              stopOpacity: 1\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 320,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 313,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"use\", {\n        href: \"#outline\",\n        fill: \"#000\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 324,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"g\", {\n        children: /*#__PURE__*/_jsxDEV(\"path\", {\n          d: path(graticule),\n          stroke: \"#ccc\",\n          fill: \"none\",\n          strokeWidth: \"0.5\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 327,\n          columnNumber: 9\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 326,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"use\", {\n        href: \"#outline\",\n        fill: \"none\",\n        stroke: \"#000\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 330,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"g\", {\n        className: \"sources\",\n        children: sources.map((source, i) => /*#__PURE__*/_jsxDEV(\"circle\", {\n          cx: projection([source.equatorial_ra, source.equatorial_dec])[0],\n          cy: projection([source.equatorial_ra, source.equatorial_dec])[1],\n          r: 5,\n          fill: \"#99fadc\",\n          stroke: \"#FFFFFF\",\n          className: \"marker\",\n          onClick: () => handleSourceClick(i)\n        }, i, false, {\n          fileName: _jsxFileName,\n          lineNumber: 335,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 332,\n        columnNumber: 7\n      }, this), highlight && /*#__PURE__*/_jsxDEV(\"g\", {\n        children: [/*#__PURE__*/_jsxDEV(\"circle\", {\n          cx: projection([sources[highlightId].equatorial_ra, sources[highlightId].equatorial_dec])[0],\n          cy: projection([sources[highlightId].equatorial_ra, sources[highlightId].equatorial_dec])[1],\n          r: 10,\n          fill: \"none\",\n          stroke: \"#7021e4\",\n          strokeWidth: \"3\",\n          className: \"highlight\",\n          onClick: () => handleSourceClick()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 352,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"text\", {\n          x: projection([sources[highlightId].equatorial_ra, sources[highlightId].equatorial_dec])[0] + 8,\n          y: projection([sources[highlightId].equatorial_ra, sources[highlightId].equatorial_dec])[1] + 6,\n          class: \"large\",\n          fill: \"#DAFF1F\",\n          children: sources[highlightId].name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 362,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 351,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"g\", {\n        children: [/*#__PURE__*/_jsxDEV(\"text\", {\n          x: projection([0, 0])[0],\n          y: projection([0, 0])[1],\n          class: \"small\",\n          fill: \"yellow\",\n          children: \"Vernal Equinox\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 373,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"text\", {\n          x: projection([0, 90])[0],\n          y: projection([0, 90])[1],\n          class: \"small\",\n          fill: \"yellow\",\n          children: \"NCP\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 381,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"text\", {\n          x: projection([0, -90])[0],\n          y: projection([0, -90])[1],\n          class: \"small\",\n          fill: \"yellow\",\n          children: \"SCP\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 389,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 372,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 307,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      class: \"overlay2\",\n      children: Footer()\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 401,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 301,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Map, \"tw3lcZFU5/OTktfOJ49yyPVplYk=\");\n\n_c = Map;\nexport default Map;\n\nvar _c;\n\n$RefreshReg$(_c, \"Map\");","map":{"version":3,"sources":["/home/rmehta/astrosat/Astrosat-Webapp/src/components/mainMap.js"],"names":["React","Component","useState","useEffect","useRef","pdf","geoPath","d3","Dropdown","aitoffProj","hammerProj","mollweideProj","graticule","outline","Navbar","Form","Input","Button","Checkbox","Select","Row","Col","Option","versor","require","Map","props","mapWidth","setMapWidth","window","innerWidth","highlight","toggleHighlight","highlightId","setHighlightId","query","setQuery","projVal","setProjVal","projection","setProjection","x0","y0","x1","y1","fitWidth","bounds","mapHeight","Math","ceil","l","min","scale","precision","path","setPath","sources","setSources","v0","q0","r0","fetch","then","response","status","console","log","json","cosmicData","map","select","call","drag","on","dragstarted","dragged","event","cartesian","invert","pointer","rotate","v1","q1","multiply","delta","r1","rotation","handleSourceClick","id","zoom","_scale","undefined","scaleExtent","vv0","qq0","rr0","aa0","tl","zoomstarted","zoomed","transform","k","pt","vv1","deltaa","qq1","x","Object","assign","selection","property","zoomIdentity","type","options","length","InfoPanel","name","equatorial_ra","equatorial_dec","galactic_longitude","galactic_latitude","x_ray_flux","findWithAttr","array","attr","value","i","onSubmit","e","preventDefault","res","handleProjChange","onFinish","values","search","onFinishFailed","errorInfo","Footer","color","background","remember","required","message","display","justifyContent","justifyItems","stopColor","stopOpacity","source"],"mappings":"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","sourcesContent":["import React, { Component, useState, useEffect, useRef  } from 'react'\nimport 'semantic-ui-css/semantic.min.css'\n\nimport pdf from \"../resources/info.pdf\"\n\nimport {geoPath, } from \"d3-geo\"\nimport * as d3 from \"d3\"\n\nimport { Dropdown} from 'semantic-ui-react'\n\nimport {aitoffProj, hammerProj, mollweideProj, graticule, outline} from \"./utils\"\nimport \"./mainMap.css\"\n\nimport Navbar from \"./navbar\"\n \n \n\nimport { Form, Input, Button, Checkbox, Select, Row, Col } from \"antd\";\nconst { Option } = Select;\n\nconst versor = require(\"versor\");\n\n\nfunction Map(props){\n\n  const [mapWidth, setMapWidth] = useState(window.innerWidth);\n  const [highlight, toggleHighlight] = useState(false)\n  const [highlightId, setHighlightId] = useState()\n  const [query, setQuery] = useState(\"\")\n  const [projVal, setProjVal] = useState(\"A\")\n\n  const [projection, setProjection] = useState(() => aitoffProj);\n\n  const [[x0, y0], [x1, y1]] = d3.geoPath(projection.fitWidth(mapWidth, outline)).bounds(outline);\n  const mapHeight = Math.ceil(y1 - y0), l = Math.min(Math.ceil(x1 - x0), mapHeight);\n  projection.scale(projection.scale() * (l - 1) / l).precision(0.2);\n  \n  const [path, setPath] = useState(() => geoPath(projection));\n  const [sources, setSources] = useState([])\n\n  // const [graticule, setGraticule] = useState(graticule);\n\n  var v0, q0, r0;\n  \n  \n\n  useEffect(() => {\n\n    fetch(\"https://backend.cosmoscope.in/cosmicsource/\")\n  .then(response => {\n    if (response.status !== 200) {\n      console.log(`There was a problem: ${response.status}`)\n      return\n    }\n    response.json().then(cosmicData => {\n      setSources(cosmicData)\n    })\n  })\n    \n    let map = d3.select(\"#outline\") \n  \n    map.call(d3.drag()\n    .on(\"start\", dragstarted)\n    .on(\"drag\", dragged)\n    );\n\n    // map.call(zoom(projection))\n  }, [])\n\n  const dragstarted = (event) => {\n    v0 = versor.cartesian(projection.invert(d3.pointer(event)));\n    r0 = projection.rotate();\n    q0 = versor(r0);\n  }\n  \n  const dragged = (event) => {\n    var v1 = versor.cartesian(projection.rotate(r0).invert(d3.pointer(event))),\n        q1 = versor.multiply(q0, versor.delta(v0, v1)),\n        r1 = versor.rotation(q1);\n    projection.rotate(r1);\n\n    setPath(() => geoPath(projection))\n  }\n\n  const handleSourceClick = (id) => {\n    \n    toggleHighlight(highlight => !highlight)\n    setHighlightId(id)\n  }\n\n  function zoom(projection, {\n    // Capture the projection’s original scale, before any zooming.\n    scale = projection._scale === undefined\n      ? (projection._scale = projection.scale()) \n      : projection._scale,\n    scaleExtent = [0.8, 8]\n  } = {}) {\n    let vv0, qq0, rr0, aa0, tl;    \n  \n    const zoomstarted = (event) => {\n      vv0 = versor.cartesian(projection.invert(d3.pointer(event)));\n      qq0 = versor((rr0 = projection.rotate()));\n    }\n  \n    const zoomed = (event) => {\n      projection.scale(event.transform.k);\n      const pt = d3.pointer(event);\n      const vv1 = versor.cartesian(projection.rotate(rr0).invert(pt));\n      const deltaa = versor.delta(vv0, vv1);\n      let qq1 = versor.multiply(qq0, deltaa);\n  \n      projection.rotate(versor.rotation(qq1));\n\n      setPath(() => geoPath(projection))\n    }\n\n    const zoom = d3.zoom()\n        .scaleExtent(scaleExtent.map(x => x * scale))\n        .on(\"start\", zoomstarted)\n        .on(\"zoom\", zoomed);\n  \n    return Object.assign(selection => selection\n        .property(\"__zoom\", d3.zoomIdentity.scale(projection.scale()))\n        .call(zoom), {\n      on(type, ...options) {\n        return options.length\n            ? (zoom.on(type, ...options), this)\n            : zoom.on(type);\n      }\n    });\n  }\n\n  // const handlePdf = e => {\n  //   const urlPDF = require()\n  //   window.open({pdf}, \"_blank\")\n  // }\n\n  function InfoPanel() {\n    return(\n      <div class=\"bg\">\n        <div class=\"bgg\"> \n        <p>Name: {sources[highlightId].name}</p>\n        <p>Ra, Dec: {sources[highlightId].equatorial_ra}, {sources[highlightId].equatorial_dec}</p>\n        <p>Gal. Long/Lat: {sources[highlightId].galactic_longitude}, {sources[highlightId].galactic_latitude}</p>\n        <p>X-Ray Flux: {sources[highlightId].x_ray_flux}</p>\n        <p>AstroSat? : {highlightId === 167 ? \"yes\" : \"no\"}</p>\n        </div>\n        {highlightId === 167 && (\n          <div>\n            <p>Observation date: 2018-09-17</p>\n            <p>Observation time: 08:09:52</p>\n            <p>Cycle: A04_230\tT01</p>\n            <p>Observation ID: 04_230T01_9000002374</p>\n            <p>Observation ID: 04_230T01_9000002374</p>\n            <p>Telescope: laxpc1</p>\n            <a href = {pdf} target = \"_blank\">Download Pdf</a>\n            {/* <Button \n              onClick={handlePdf}\n            >\n              Download PDF\n            </Button> */}\n          </div>\n        )}\n        \n      </div>\n    )\n  }\n  \n  function findWithAttr(array, attr, value) {\n    for(var i = 0; i < array.length; i += 1) {\n        if(array[i][attr] === value) {\n            return i;\n        }\n    }\n    return -1;\n}\n\n  const onSubmit = (e) => {\n    e.preventDefault();\n    var res = findWithAttr(sources, \"name\", query)\n    if (res === -1) {\n      res = findWithAttr(sources, \"name2\", query)\n    }\n\n    if (res === -1) {\n      res = findWithAttr(sources, \"name3\", query)\n    }\n\n    if (res !== -1) {\n      setHighlightId(res)\n      toggleHighlight(true)\n    }\n\n  }\n\n  useEffect(() => {\n    setPath(() => geoPath(projection))\n  }, [projection]);\n\n  const handleProjChange = (e, value) => {\n    \n    if(value.value === \"A\") {\n      setProjection(() => aitoffProj)\n    } else if(value.value === \"H\") {\n      setProjection(() => hammerProj)\n    } if(value.value === \"M\") {\n      setProjection(() => mollweideProj)\n    }\n  }\n\n  const onFinish = (values) => {\n\n    var res = findWithAttr(sources, \"name\", values.search)\n    if (res === -1) {\n      res = findWithAttr(sources, \"name2\", values.search)\n    }\n\n    if (res === -1) {\n      res = findWithAttr(sources, \"name3\", values.search)\n    }\n\n    if (res !== -1) {\n      setHighlightId(res)\n      toggleHighlight(true)\n    }\n  }\n\n  const onFinishFailed = (errorInfo) => {\n    console.log(\"Failed:\", errorInfo);\n  };\n\n  \n\n  function Footer() {\n    return (\n      <div className=\"custom-footer\" style={{color:'black', background:'#c0b9b924'}}>\n        <Row>\n        <Col span = {20}>\n        <Form\n          name=\"Query\"\n          initialValues={{ remember: true }}\n          onFinish={onFinish}\n          onFinishFailed={onFinishFailed}\n          layout=\"inline\"\n        >\n\n\n          <Form.Item\n            label=\"Search\"\n            placeholder=\"Name (Primary/Alternate)\"\n            name=\"search\"\n          >\n            <Input  />\n          </Form.Item>\n\n          <Form.Item>\n          <Button type=\"primary\" htmlType=\"submit\">\n            Submit\n          </Button>\n        </Form.Item>\n        </Form>\n        </Col>\n\n        <Col >\n\n        <Form\n          name=\"Projection\"\n          layout=\"inline\"\n        >\n        <Form.Item\n          label=\"Projection (ICRS)\"\n          name=\"type\"\n          rules={[{ required: true, message: \"Please select projection\" }]}\n\n          style = {{\n            display : \"flex\",\n            justifyContent : \"flex-end\",\n            justifyItems : \"flex-end\"\n          }}\n        >\n          <Select placeholder=\"Projectiom\" onChange = {handleProjChange} >\n            <Option value=\"A\">Aitoff</Option>\n            <Option value=\"H\">Hammer</Option>\n            <Option value=\"M\">Mollweide</Option>\n          </Select>\n        </Form.Item>\n\n   \n        </Form>\n\n          </Col>\n\n        \n        </Row>\n\n      </div>\n    );\n  }\n \n  return (\n    <div>\n      <div class=\"overlay\"><Navbar/></div>\n      {\n        highlight && (<div><InfoPanel id={1}/></div>)\n      }\n      \n      <svg\n        width = {mapWidth}\n        height = {mapHeight}\n        viewBox={`0 0 ${mapWidth} ${mapHeight}`}\n        id=\"map\"\n      >\n      <defs>\n        <path \n          id=\"outline\" \n          d={path(outline)}\n        />\n        <linearGradient id=\"grad2\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n          <stop offset=\"0%\" style={{stopColor: `rgb(0,0,255)`, stopOpacity:1}} />\n          <stop offset=\"100%\" style={{stopColor: `rgb(0,0,0)`, stopOpacity:1}} />\n        </linearGradient>\n      </defs>\n\n      <use href=\"#outline\" fill=\"#000\"/>\n\n      <g>\n        <path d={path(graticule)} stroke=\"#ccc\" fill=\"none\" strokeWidth=\"0.5\"/>\n      </g>\n      \n      <use href=\"#outline\" fill=\"none\" stroke=\"#000\"/>\n\n      <g className=\"sources\">\n        {\n          sources.map((source, i) => (\n            <circle\n              key={i}\n              cx={ projection([source.equatorial_ra, source.equatorial_dec])[0] }\n              cy={ projection([source.equatorial_ra, source.equatorial_dec])[1] }\n              r={ 5 }\n              fill=\"#99fadc\"\n              stroke=\"#FFFFFF\"\n              className=\"marker\"\n              onClick={ () => handleSourceClick(i) }\n            />\n\n          ))\n        }  \n      </g>\n\n      {highlight && (\n        <g>\n          <circle\n          cx={ projection([sources[highlightId].equatorial_ra, sources[highlightId].equatorial_dec])[0] }\n          cy={ projection([sources[highlightId].equatorial_ra, sources[highlightId].equatorial_dec])[1] }\n          r={10}\n          fill=\"none\"\n          stroke=\"#7021e4\"\n          strokeWidth=\"3\"\n          className=\"highlight\"\n          onClick={ () => handleSourceClick() }\n        />\n        <text \n          x={ projection([sources[highlightId].equatorial_ra, sources[highlightId].equatorial_dec])[0] + 8 }\n          y={ projection([sources[highlightId].equatorial_ra, sources[highlightId].equatorial_dec])[1] + 6 }\n          class=\"large\"\n          fill=\"#DAFF1F\"\n          >\n            {sources[highlightId].name}\n        </text>\n        </g>\n      )}\n      <g>\n        <text \n          x={ projection([0,0])[0] }\n          y={ projection([0,0])[1] }\n          class=\"small\"\n          fill=\"yellow\"\n          >\n            Vernal Equinox\n        </text>\n        <text \n          x={ projection([0,90])[0] }\n          y={ projection([0,90])[1] }\n          class=\"small\"\n          fill=\"yellow\"\n          >\n            NCP\n        </text>\n        <text \n          x={ projection([0,-90])[0] }\n          y={ projection([0,-90])[1] }\n          class=\"small\"\n          fill=\"yellow\"\n          >\n            SCP\n        </text>\n      </g>\n      \n      </svg>\n\n      <div class=\"overlay2\">\n        {Footer()}\n      </div>\n    </div>\n  )\n}\n\n\nexport default Map"]},"metadata":{},"sourceType":"module"}